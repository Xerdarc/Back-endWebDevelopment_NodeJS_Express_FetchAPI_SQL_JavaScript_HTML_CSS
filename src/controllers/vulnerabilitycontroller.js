// import the model module
const model = require("../models/vulnerabilitymodel")

// ========== GET ==========
module.exports.get = (req, res) => {
	const callback = (error, results) => {
		if (error) {
			console.error(error)
			res.status(500).json({message: "Internal server error."})
			return
		}
		if (results.length == 0) {
			res.status(404).json({message: "No vulnerabilities yet."})
			return
		}
		else {
			res.status(200).json(results)
		}
	}
	model.select(callback)
}

// ========== POST ==========
module.exports.post = (req, res, next) => {
	const data = {
		type: req.body.type,
		description: req.body.description,
		points: req.body.points,
		user_id: res.locals.user_id
	}
	if (!req.body.type || !req.body.description || req.body.points == undefined || req.body.points == "") { // since the ! operator catches 0 as well
		res.status(400).send("Please make sure all required fields are filled up.")
		return
	}
	const callback = (error, results) => {
		if (error) {
			console.error(error)
			res.status(500).json({message: "Internal server error."})
			return
		}
		else {
			next()
		}
	}
	model.insert(data, callback)
}

// ========== FOR QUESTS ==========
module.exports.awardcredits = (req, res) => {
	const data = {
		user_id: res.locals.user_id
	}
	const callback = (error, results) => {
		if (error) {
			console.error(error)
			res.status(500).json({message: "Internal server error."})
			return
		}
		else {
			res.status(201).json(results)
		}
	}
	model.credits(data, callback)
}